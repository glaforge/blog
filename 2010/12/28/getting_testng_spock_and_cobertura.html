<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>JBake Bootstrap Template</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">    

    <!-- Le styles -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/asciidoctor.css" rel="stylesheet">
    <link href="css/base.css" rel="stylesheet">
    <link href="css/bootstrap-responsive.min.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="/js/html5shiv.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="favicon.ico">
  </head>
  <body>
    <div id="wrap">
   
	
	<!-- Fixed navbar -->
      <div class="navbar navbar-fixed-top">
        <div class="navbar-inner">
          <div class="container">
            <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="brand" href="/blog">Cédric Champeau's blog</a>
            <div class="nav-collapse collapse">
              <ul class="nav">                
                <li><a href="/blog/about.html">About</a></li>
                <li><a href="/blog/feed.xml">Feed</a></li>                
              </ul>
            </div><!--/.nav-collapse -->
          </div>
        </div>
      </div>
      <div class="container">
	
	<div class="page-header">
		<h1>Getting TestNG, Spock and Cobertura to work together with Maven</h1>
	</div>

	<p><em>28 décembre 2010</em></p>
	<p><em>Tags: </em>cobertura </em> maven </em> spock </em> testng </p>

	<p><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Cobertura, TestNG and Maven play well together. However, I had problems when I started migrating some tests to <a href="http://code.google.com/p/spock/">the Spock framework</a>. Long story short, Spock uses JUnit internally, not TestNG, and the surefire plugin only triggers tests for one of those frameworks at a time. Therefore, if you mix TestNG with Spock, you’ll run with problems where your Spock tests won’t be started automatically by Maven, and eventually, Cobertura will never generate test coverage for the corresponding classes.</p>
</div>
<div class="paragraph">
<p>I have found different proposals for fixing this problem, but only one worked for me, so here’s my working pom.xml :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code>
...

                1.7.6
  0.5-groovy-1.7
  1.2

...



   org.testng
   testng
   5.8
   test
   jdk15


   org.codehaus.groovy
   groovy-all
   ${groovy.version}


     junit
     junit


     org.apache.ant
     ant


     org.apache.ant
     ant-launcher


     jline
     jline





   org.spockframework
   spock-core
   ${spock.version}
   test



   org.codehaus.gmaven.runtime
   gmaven-runtime-1.7
   ${gmaven.version}


     org.codehaus.groovy
     groovy-all



...





    org.codehaus.gmaven
    gmaven-plugin
    ${gmaven.version}



       1.7


       generateStubs
       compile
       generateTestStubs
       testCompile






    org.apache.maven.plugins
    maven-surefire-plugin
    2.7.1


      test

       test


       none:none



      test-testng
      test

       test


       none:none





    org.spockframework
    spock-maven
    ${spock.version}



       find-specs





    org.codehaus.mojo
    cobertura-maven-plugin
    2.4


      cobertura-test
      package

       cobertura



        false




      cobertura-clean
      clean

       clean






</code></pre>
</div>
</div>
<div class="paragraph">
<p>The trick is to add two executions of the surefire plugin, as <a href="http://bit.ly/ePc0oG">indicated here</a>, but forcing the plugin version to 2.7.1. Also, adding two dependencies to the surefire plugin, as suggested by <a href="http://twitter.com/#!/krosenvold/status/19442054924861441">Kristian Rosenvold</a> didn’t work for me. My pom.xml file also includes the necessary configuration for GMaven to work with Groovy 1.7 instead of 1.6 by default.</p>
</div>
</div>
</div></p>

	<hr>
	
		</div>
		<div id="push"></div>
    </div>
    
    <div id="footer">
      <div class="container">
	<p class="muted credit">All posts on this blog are published with a <em>Creative Commons by-nb-sa</em> license.<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/2.0/fr/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/2.0/fr/88x31.png"/></a></p>
        <p class="muted credit">&copy; 2013 | Mixed with <a href="http://twitter.github.com/bootstrap/">Bootstrap v2.3.1</a> | Baked with <a href="http://jbake.org">JBake v2.2.0</a></p>
      </div>
    </div>
    
    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="js/jquery-1.9.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/run_prettify.js"></script>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
  </body>
</html>
